function initTranslateExpert(){void 0!==document.js_const_client_translate_expert_is_enabled&&document.js_const_client_translate_expert_is_enabled&&(addTranslateExpertElements(),setInterval(function(){addTranslateExpertElements()},1e3),initModule())}function clickTranslateExpertLocalizationHeader(t){$(t).parent().parent().next().is(":hidden")?($(t).parent().parent().next().show(),$(t).parent().parent().next().next().show(),$(t).parent().parent().next().next().next().show()):($(t).parent().parent().next().hide(),$(t).parent().parent().next().next().hide(),$(t).parent().parent().next().next().next().hide())}function doSaveLocalizationExpert(t,e=null){var a=$(t).parent().parent().prev().data("path-to");console.log(a);var n=$(t).parent().parent().next().find(".localization-analize-file.from pre").data("lang-from");console.log(n);var o=$(t).parent().parent().next().find(".localization-analize-file.to textarea"),n=o.data("lang-to");console.log(n);t=o[0].value;$.post(document.location.href.split("?")[0]+"?route="+document.js_const_module_prefix+"/client_translate_expert/saveLocalizationFile&user_token="+getOcuser_token(),{fileContent:t,langId:n,path:a}).done(function(t){console.log(t),t.success?(showTranslateExpertInfoMessage("Saved!",o),console.log("doSaveLocalizationExpert: success"),e&&e()):showTranslateExpertErrorMessage(t,o)}).fail(function(t){console.log(t),showTranslateExpertErrorMessage(t,o)})}function doTranslateLocalizationExpert(t,e=null){var a=$(t).parent().parent().prev().data("path-to");console.log(a);var n=$(t).parent().parent().next().find(".localization-analize-file.from pre").data("lang-from");console.log(n);var o=$(t).parent().parent().next().find(".localization-analize-file.to textarea"),r=o.data("lang-to");console.log(r),document.localizationAnalizationResult.forEach(t=>{t.pathTo==a&&(console.log(t),t=t.toTranslate,doTranslateLocalization(n,r,t,o,e))})}function doTranslateLocalizationAllExpert(t=0){var e,a,n=$(".translate_localization_button");t<n.length?(e=n[t],a=$(e).parent().parent().prev().data("path-to"),showTranslateExpertModal("Translation of localization file {currIndex} of {count}: {path}.".replace("{currIndex}",t+1).replace("{count}",n.length).replace("{path}",a)),doTranslateLocalizationExpert(e,function(){doSaveLocalizationExpert(e,function(){doTranslateLocalizationAllExpert(++t)})})):showTranslateExpertModal("Translation of localization file {currIndex} of {count}: Done!".replace("{currIndex}",n.length).replace("{count}",n.length).replace("{path}",a))}function doTranslateLocalization(t,e,r,l,s=null){var a=[];Object.entries(r).forEach(([,t])=>{valueStr=t.text.trim(),valueStr&&a.push(valueStr)}),console.log(a),$.post(document.location.href.split("?")[0]+"?route="+document.js_const_module_prefix+"/client_translate_expert/translate&user_token="+getOcuser_token(),{textArr:JSON.stringify(a),source:t,target:e,format:"html"}).done(function(a){var n,o;console.log(a),a.success?((!(n=l.text())||-1===n.indexOf("<?php")||-1!==n.indexOf("<?php")&&-1!==n.indexOf("?>")&&n.lastIndexOf("<?php")<n.lastIndexOf("?>"))&&(n+="\n\n<?php\n"),n&&(n+="\n"),-1===n.indexOf("Массовый автоматический перевод текстов, товаров, категорий, статей и тд с Google translate API")&&(n+="/*\nTranslated with\nМассовый автоматический перевод текстов, товаров, категорий, статей и тд с Google translate API\nhttps://translator.codeguild.com.ua/\n*/"),o=0,Object.entries(r).forEach(([t,e])=>{e=(e=e.text.trim()?a.texts[o++]:"").replaceAll('"','\\"');n+="\n$_['"+t+"'] = \""+e+'";'}),l.text(n),l[0].scrollTop=l[0].scrollHeight,s&&s()):showTranslateExpertErrorMessage(a,l)}).fail(function(t){console.log(t),showTranslateExpertErrorMessage(t,l)})}function updateSimpleElements(){-1!=getParameter("route").indexOf("/simple")&&(document.vh_settings_index||(document.vh_settings_index=1),$("div.setting").filter(function(){return!$(this).data("te-vh-index")}).each(function(t){$(this).data("te-vh-index","vh_settings_index_"+document.vh_settings_index++)}),$(["textarea.form-control","input.form-control"].join(",")).filter(function(){return!$(this).attr("name")&&1==$(this).parent().find("span.lang > img[alt]").length}).each(function(t){var e=$(this).parent().find("span.lang > img[alt]").prop("alt").replace("_","-"),e="_te_vh["+document.js_const_client_translate_expert_languages[e].language_id+"]["+$(this).parent().parent().data("te-vh-index")+"]";$(this).attr("name",e)}))}function updateBatchEditorElements(){$(["textarea[id^='description_'][id$='_description']"].join(",")).filter(function(){return!$(this).attr("name")}).each(function(t){var e=/^(.*)\_(\d+)\_(.*)$/.exec($(this).attr("id")),e=e[1]+"_te_vh["+e[2]+"]["+e[3]+"_te_vh]";$(this).attr("name",e)})}function updateHandyProductManagerElements(){var a;-1!=getParameter("route").indexOf("handy_product_manager/productList")&&(a=/^(.*)\-(\d+)\-(\d+)$/,$(["#products-list tr[data-product-id] input[type='text'][id*='-']","#products-list tr[data-product-id] textarea[id*='-']"].join(",")).filter(function(){return!$(this).attr("name")&&null!=a.exec($(this).attr("id"))}).each(function(t){var e=a.exec($(this).attr("id")),e=e[1]+"_te_vh["+e[3]+"]["+e[2]+"_te_vh]";$(this).attr("name",e)}))}function addTranslateExpertElements(){updateSimpleElements(),updateBatchEditorElements(),updateHandyProductManagerElements();var t=$(["input[type='text'][name*='['][name*=']']","input.form-control[name*='_te_vh['][name*='['][name*=']']","textarea[name*='['][name*=']']"].join(",")).filter(function(){return!$(this).attr("translate_expert_processed")&&checkElementSupportTranslateExpert(this)});t.attr("translate_expert_processed","1");var e=document.location.href.substr(0,document.location.href.indexOf("index.php"));$('<input type="button" class="translate_button" '+('style="background-image: url('+e+'view/image/translate_expert_client/translate-icon-32.png);width:15px;height:15px;background-size:cover;border:none;"')+' title="Translate" onclick="doTranslateExpert(this)">').insertBefore(t)}function checkElementSupportTranslateExpert(t){var e=getTranslateExpertFromElement(t);if(e&&0!=e.length){var a=/^(uni_set)[^\d]*\[(\d+)\].*?(?:\[([^\[]+)\]|)$/,e=a.exec(t.name);if(e=e||((e=(a=/^(.+)\[(\d+)\].*\[([^\[]+)\]$/).exec(t.name))||(a=/^(.+)\[(\d+)\].*?(?:\[([^\[]+)\]|)$/).exec(t.name)))if(!(-1<["product_attribute"].indexOf(e[1])||-1<["quantity","quantity","priority","price","date_start","date_end","date","points","sort_order","model","sku","keyword","color","seourl","link","column"].indexOf(e[3])))return 1}}function showTranslateExpertErrorMessage(t,e){console.log("!!!!!!!!!!!Translate Expert Error!!!!!!!!!!!!!"),console.log(t);var a="";t.hasOwnProperty("message")&&(a=t.message),""==(a=t.hasOwnProperty("responseText")?t.responseText:a)&&(a="Internal error, more info in console log!<br><br>",("string"==typeof t||t instanceof String)&&(a+=-1!==t.indexOf("</title>")?$("<p></p>").html(t).text():t)),t.hasOwnProperty("additional_message")&&(a+="<br>"+t.additional_message),a=a.substring(0,2e3),console.log(a),console.log(e),e=e||$("#te-analization-mode")[0],$(".alert.alert-danger").remove(),$(e).before('<div class="alert alert-danger" style="display: none;"><i class="fa fa-exclamation-circle"></i> '+a+"</div>"),$(".alert-danger").slideDown(),$(".stop_modal_process").hide(),$(".close_modal").removeAttr("disabled"),$("#translateExpertModal").modal("hide")}function showTranslateExpertInfoMessage(t,e){e=e||$("#te-analization-mode")[0],$(".te-info").remove(),$(e).before('<div class="te-info" style="display: none;"><i class="fa fa-info-circle"></i> '+t+"</div>"),$(".te-info").slideDown()}function isTranslateExpertSummernote(t){return null!=$(t).data&&null!=$(t).data()&&null!=$(t).data().summernote}function isTranslateExpertSummernoteOld(t){return null!=$(t).code&&"textarea"===$(t).prop("tagName").toLowerCase()&&!!$(t).code()}function isTranslateExpertCKEDITOR(t){return null!=getElementCKEDITOR(t)}function isTranslateExpertHTMLEditor(t){return isTranslateExpertCKEDITOR(t)||isTranslateExpertSummernote(t)||isTranslateExpertSummernoteOld(t)}function getElementCKEDITOR(t){if("undefined"!=typeof CKEDITOR){t=(t=t instanceof jQuery?t[0]:t).id||t.name;return CKEDITOR.instances[t]}}function setTranslateExpertValue(t,e){$(t).trigger("click");var a=jQuery.Event("keydown");a.which=32,$(t).trigger(a),$(t).trigger("keyup"),$(t).focus(),isTranslateExpertSummernote(t)?$(t).summernote("code",e):isTranslateExpertCKEDITOR(t)?getElementCKEDITOR(t).setData(e):isTranslateExpertSummernoteOld(t)?$(t).code(e):$(t).val(e),$(t).trigger("change"),$(t).change()}function getTranslateExpertValue(t){return isTranslateExpertSummernote(t)?$(t).summernote("code"):isTranslateExpertCKEDITOR(t)?getElementCKEDITOR(t).getData():isTranslateExpertSummernoteOld(t)?$(t).code():$(t).val()}function getParameter(t){return new URLSearchParams(window.location.search).get(t)}function getOcuser_token(){return getParameter("user_token")}function showTranslateExpertModal(t){$("#translateExpertModal .modal-body").html(t),$("#translateExpertModal").modal({backdrop:"static",keyboard:!1})}function getTranslateExpertFromElement(t){var e=/^(uni_set[^\d]*\[)(\d+)(\].*)$/,a=e.exec(t.name);if(a=a||(e=/^(.*\[)(\d+)(\].*)$/).exec(t.name)){var n=a[1],e=a[2],a=a[3],a=(a=$(t.tagName+"[name^='"+n+"'][name$='"+a+"']")).filter(function(){return this!=t&&!!getTranslateExpertValue($(this))}).first();return $(a).attr("targetLangId",e),a}}function getElementLangId(t){var e=/^(uni_set[^\d]*\[)(\d+)(\].*)$/,a=e.exec(t.name);if(!(a=a||(e=/^(.*\[)(\d+)(\].*)$/).exec(t.name)))return"";a[1];t=a[2],a[3];return t}function doTranslateExpert(t){$(".alert.alert-danger").remove();var e,a=t,n=a.nextSibling,o=getTranslateExpertFromElement(n),r=getTranslateExpertValue(o);console.log(r),r&&(e=getElementLangId(o[0]),t=isTranslateExpertHTMLEditor(n)?"html":"text",$.post(document.location.href.split("?")[0]+"?route="+document.js_const_module_prefix+"/client_translate_expert/translate&user_token="+getOcuser_token(),{text:r,source:e,target:$(o).attr("targetLangId"),format:t}).done(function(t){console.log(t),t.success?setTranslateExpertValue(n,t.text):showTranslateExpertErrorMessage(t,a)}).fail(function(t){console.log(t),showTranslateExpertErrorMessage(t,a)}))}function analizeTableDetail(t,e,a,n,o,r,l,s,i){$(".alert.alert-danger").remove(),document.stopTranslationModelProcess=!1,$("#statusLog").html(""),$(".stop_modal_process").hide(),$(".close_modal").removeAttr("disabled"),showTranslateExpertModal("Preparing detail info ..."),$.post(document.location.href.split("?")[0]+"?route="+document.js_const_module_prefix+"/client_translate_expert/analizeTableDetail&user_token="+getOcuser_token(),{langIdFrom:t,mode:e,tableName:a,textColumnName:n,langIdTo:o,product_status:r,product_quantity:l,product_category_id:s,stock_status:i}).done(function(t){console.log(t),t.success?showTranslateExpertModal(t.result):showTranslateExpertErrorMessage(t,null)}).fail(function(t){console.log(t),showTranslateExpertErrorMessage(t,null)})}function doTranslateTableExpert(t,e,a,n,o,r,l,s,i,c){confirm(c)&&($(".alert.alert-danger").remove(),document.stopTranslationModelProcess=!1,$("#statusLog").html(""),$(".stop_modal_process").show(),$(".close_modal").attr("disabled",1),document.tablesToTranslate="all"==a?$.map($(".et_table").toArray(),function(t,e){return t.innerHTML}):[a],showTranslateExpertModal(getTranslateExpertStatisticHtml("",document.js_const_in_progress_status,0)),doTranslateTableExpertRecursive(t,e,document.tablesToTranslate[0],n,o,r,l,s,i))}function doTranslateTableExpertRecursive(a,n,o,r,l,s,i,c,d){$.post(document.location.href.split("?")[0]+"?route="+document.js_const_module_prefix+"/client_translate_expert/translateTable&user_token="+getOcuser_token(),{langIdFrom:a,mode:n,tableName:o,textColumnName:r,langIdTo:l,product_status:s,product_quantity:i,product_category_id:c,stock_status:d}).done(function(t){var e;console.log(t),t.success?document.stopTranslationModelProcess||(e=t.translatedCharCount+(parseInt($("#statusCurrent .statusTranslatedCharCount").html())?parseInt($("#statusCurrent .statusTranslatedCharCount").html()):0),t.done?(showTranslateExpertModal(getTranslateExpertStatisticHtml("",document.js_const_done_status,e)),document.tablesToTranslate.shift(),0<document.tablesToTranslate.length?(showTranslateExpertModal(getTranslateExpertStatisticHtml($("#statusCurrent").html(),document.js_const_in_progress_status,0)),doTranslateTableExpertRecursive(a,n,document.tablesToTranslate[0],r,l,s,i,c,d)):($(".stop_modal_process").hide(),$(".close_modal").removeAttr("disabled"))):(showTranslateExpertModal(getTranslateExpertStatisticHtml("",document.js_const_in_progress_status,e)),doTranslateTableExpertRecursive(a,n,o,r,l,s,i,c,d))):showTranslateExpertErrorMessage(t,null)}).fail(function(t){console.log(t),showTranslateExpertErrorMessage(t,null)})}function getTranslateExpertStatisticHtml(t,e,a){return document.js_const_statistic_html.replaceAll("{historyLog}",(0<$("#statusLog").length?$("#statusLog").html()+(t?"<br>":""):"")+t).replaceAll("{table}",document.tablesToTranslate[0]).replaceAll("{status}",e).replaceAll("{translatedCharCount}",a)}function confirmStopTranslationModelProcess(t){t=confirm(t);return t&&(document.stopTranslationModelProcess=!0,$("#translateExpertModal").modal("hide")),t}function makeLocalizationAnalizeRequest(e=0){var t=new URLSearchParams(window.location.search).get("user_token"),a=$("#te-localization-language-from").val(),n=$("#te-localization-language-to").val();$.get(document.location.href.split("?")[0]+"?route="+document.js_const_module_prefix+"/client_translate_expert/analizeLocalization&user_token="+t+"&langIdFrom="+a+"&langIdTo="+n+"&nextFileIndex="+e).done(function(t){return t.success?(console.log(t),0==e?($("#te-localization-analization-result").html(t.html),document.localizationAnalizationResult=t.analize):document.localizationAnalizationResult=document.localizationAnalizationResult.concat(t.analize),$table=$(".localization-analize-table"),$table.html($table.html()+t.detailsHtml),void(t.done||makeLocalizationAnalizeRequest(t.nextFileIndex))):(showTranslateExpertErrorMessage(t,$("#te-localization-language-from")[0]),void $("#te-analization-result").html(t))}).fail(function(t){console.log(t),showTranslateExpertErrorMessage(t,$("#te-localization-language-from")[0]),$("#te-analization-result").html(t)})}function makeAnalizeRequest(t=null,e=null,a=null){var n,o,r,l,s,i,c,d,u,p;document.stopTranslationModelProcess?$("#te-begin-analization").prop("disabled",!1):(n=new URLSearchParams(window.location.search).get("user_token"),o=$("#te-analization-language-from").val(),r=$("#te-analization-language-to").val(),l=$("#te-analization-mode").val(),s=$("#te-analization-table").val(),i=$("#te-analization-product-status-filter").is(":checked"),c=$("#te-analization-product-quantity-filter").is(":checked"),d=$("#te-analization-product-category-id-filter").val(),u=$("#te-analization-product-stock-status-filter").val(),p=$("#te-analization-table-deep").is(":checked"),$.get(document.location.href.split("?")[0]+"?route="+document.js_const_module_prefix+"/client_translate_expert/analize&user_token="+n+"&langIdFrom="+o+"&langIdTo="+r+"&mode="+l+"&table="+s+(i?"&product_status=1":"")+(c?"&product_quantity=1":"")+(d?"&product_category_id="+d:"")+(u?"&stock_status="+u:"")+(t?"&continue_after_table="+t:"")+(e?"&continue_after_column="+e:"")+(a?"&continue_offset="+a:"")).done(function(t){if(t.success){if(console.log(t),0==$("#analizeBody").length){var a="";$.each(t.result,function(t,e){a+=e.headerHTML,$.each(e.columns,function(t,e){a+=e.html})}),$("#te-analization-result").html('<div id="analizeHeadInfo" class="container">'+t.analizeHeadInfo+'</div><div id="analizeBody" class="container">'+a+'</div><br><br><div id="timeInSecInfo" class="container">'+t.timeInSecInfo+"</div>")}else{var e,n,o,a="";for(e in $.each(t.result,function(t,o){var e="#et_"+o.table;$(e).length;0==$(e).length?a+=o.headerHTML:(e="#"+o.table+"_globalCharCount",$(e).html(parseInt($(e).html())+parseInt(o.tableCharCount)),$.each(o.languageCharCounts,function(t,e){var a="#"+o.table+"_CharCount_"+e.code;$(a).html(parseInt($(a).html())+parseInt(e.char_count))})),$.each(o.columns,function(t,n){var e="#et_"+o.table+"_"+n.column;0==$(e).length?a+=n.html:(e="#"+n.table+"_"+n.column+"_globalCharCount",$(e).html(parseInt($(e).html())+parseInt(n.columnCharCount)),$.each(n.languageCharCounts,function(t,e){var a="#"+o.table+"_"+n.column+"_CharCount_"+e.code;$(a).html(parseInt($(a).html())+parseInt(e.char_count))}))})}),$("#analizeBody").html($("#analizeBody").html()+a),$("#globalCharCount").html(parseInt($("#globalCharCount").html())+parseInt(t.globalCharCount)),$("#timeInSec").html((parseFloat($("#timeInSec").html())+parseFloat(t.timeInSec)).toFixed(4)),t.globalLanguageCharCounts)t.globalLanguageCharCounts.hasOwnProperty(e)&&(o="globalLangCharCount"+(n=t.globalLanguageCharCounts[e]).code,$("#"+o).html(parseInt($("#"+o).html())+parseInt(n.char_count)));0<t.result.length&&($("#analization_current_table").html(t.result[t.result.length-1].table),$("#analization_request_number").html(parseInt($("#analization_request_number").html())+1))}t.done?($("#te-begin-analization").prop("disabled",!1),$(".close_modal").removeAttr("disabled"),$("#translateExpertModal").modal("hide")):p?makeAnalizeRequest(t.lastProcessedTable,t.lastProcessedColumn,t.lastProcessedOffset):makeAnalizeRequest(t.result[t.result.length-1].table)}else showTranslateExpertErrorMessage(t,null)}).fail(function(t){console.log(t),showTranslateExpertErrorMessage(t,null),$("#te-analization-result").html(t)}))}function initModule(){$("#te-begin-analization").click(function(){$("#te-begin-analization").prop("disabled",!0),$("#te-analization-result").html(""),document.stopTranslationModelProcess=!1,$(".close_modal").attr("disabled",1),showTranslateExpertModal(document.js_const_analization_process_is_started),makeAnalizeRequest()}),$("#te-begin-localization-analization").click(function(){makeLocalizationAnalizeRequest()}),document.js_const_module_prefix="extension/module"}"loading"==document.readyState?document.addEventListener("DOMContentLoaded",initTranslateExpert):initTranslateExpert();
