# Інструкція з автоматичного деплою на сервер

## Швидкий старт

### 1. Налаштування SSH конфігурації (перший раз)

Запустіть скрипт налаштування:

```powershell
.\setup-deploy-config.ps1
```

Скрипт запитає:
- **SSH хост** - IP адреса або домен вашого сервера
- **SSH користувач** - ім'я користувача для підключення
- **Шлях до проекту** - повний шлях до папки проекту на сервері (наприклад: `/var/www/html` або `/home/user/public_html`)
- **Метод автентифікації**:
  - SSH ключ (рекомендовано)
  - Пароль
  - Стандартні SSH ключі з `~/.ssh`

**Важливо:** Файл `deploy-config.json` містить конфіденційні дані і автоматично додається до `.gitignore`.

### 2. Використання автоматичного деплою

Після налаштування просто запускайте:

```powershell
.\deploy-auto.ps1 "Опис ваших змін"
```

Скрипт автоматично:
1. ✅ Перевірить незакомічені зміни
2. ✅ Додасть зміни до Git (якщо потрібно)
3. ✅ Створить коміт
4. ✅ Відправить на GitHub
5. ✅ Підключиться до сервера через SSH
6. ✅ Виконає `git pull` на сервері

## Детальний опис

### Що робить скрипт `deploy-auto.ps1`:

1. **Перевірка змін**
   - Показує всі незакомічені файли
   - Пропонує додати їх до коміту

2. **Створення коміту**
   - Додає всі зміни до staging area
   - Створює коміт з вашим повідомленням

3. **Синхронізація з GitHub**
   - Отримує останні зміни з сервера (якщо є)
   - Відправляє ваші зміни на GitHub

4. **Деплой на сервер**
   - Підключається до сервера через SSH
   - Виконує `git pull origin main` на сервері
   - Оновлює файли на продакшн сервері

### Альтернативні методи

#### Тільки Git (без SSH деплою)

Якщо ви не хочете налаштовувати SSH, використовуйте старий скрипт:

```powershell
.\deploy.ps1 "Опис змін"
```

Цей скрипт тільки відправить зміни на GitHub. На сервері потрібно буде вручну виконати `git pull`.

#### Вручну через Git

```powershell
# 1. Додати зміни
git add .

# 2. Створити коміт
git commit -m "Опис змін"

# 3. Відправити на GitHub
git push origin main

# 4. На сервері виконати:
ssh user@server.com
cd /path/to/project
git pull origin main
```

## Налаштування SSH ключів (рекомендовано)

### Windows

1. **Генерація SSH ключа** (якщо ще немає):
   ```powershell
   ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
   ```

2. **Копіювання ключа на сервер**:
   ```powershell
   type $env:USERPROFILE\.ssh\id_rsa.pub | ssh user@server.com "cat >> ~/.ssh/authorized_keys"
   ```

3. **Перевірка підключення**:
   ```powershell
   ssh user@server.com
   ```

### Linux/Mac

1. **Генерація SSH ключа**:
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
   ```

2. **Копіювання ключа на сервер**:
   ```bash
   ssh-copy-id user@server.com
   ```

3. **Перевірка підключення**:
   ```bash
   ssh user@server.com
   ```

## Налаштування на сервері

На сервері повинен бути:
1. ✅ Встановлений Git
2. ✅ Налаштований репозиторій (клонований з GitHub)
3. ✅ Права на запис у папку проекту
4. ✅ SSH доступ налаштований

### Перший раз на сервері:

```bash
# Підключитися до сервера
ssh user@server.com

# Перейти в папку проекту
cd /var/www/html  # або ваш шлях

# Клонувати репозиторій (якщо ще не клоновано)
git clone https://github.com/valet343/purelife.git .

# Або якщо репозиторій вже є, налаштувати remote:
git remote add origin https://github.com/valet343/purelife.git
git branch -M main
```

## Безпека

⚠️ **Важливо:**
- Файл `deploy-config.json` містить конфіденційні дані
- Він автоматично додається до `.gitignore`
- **НЕ комітьте** цей файл у Git!
- Якщо використовуєте пароль, він зберігається у відкритому вигляді
- Рекомендується використовувати SSH ключі замість паролів

## Усунення проблем

### Помилка "Permission denied"

Перевірте права доступу на сервері:
```bash
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

### Помилка "Host key verification failed"

Додайте сервер до відомих хоств:
```powershell
ssh-keyscan server.com >> $env:USERPROFILE\.ssh\known_hosts
```

### Помилка "git pull" на сервері

Перевірте права на папку проекту:
```bash
sudo chown -R user:user /path/to/project
```

### Скрипт не знаходить plink

Якщо використовуєте пароль, встановіть PuTTY:
- Завантажте з: https://www.putty.org/
- Або налаштуйте SSH ключі (рекомендовано)

## Додаткова інформація

- GitHub репозиторій: `https://github.com/valet343/purelife.git`
- Гілка за замовчуванням: `main`
- Файл конфігурації: `deploy-config.json` (не комітиться)
